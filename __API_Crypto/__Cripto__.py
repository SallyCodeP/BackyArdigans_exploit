from flask import Flask, request
from flask_restful import Api, Resource
from socket import gethostname
from threading import Thread
from time import sleep

web = Flask(__name__)
api = Api(web)

recebidos = dict()


class Getcripto(Resource):
    def get(self):
        ip = request.remote_addr
        if ip in recebidos.keys():
            print("sending!")
            return {"key": recebidos[ip]}
        else:
            return 404


class GetIP(Resource):
    def get(self, ip, code):
        recebidos[ip] = code
        Thread(target=delete, args=[ip, ]).start()
        print(recebidos)


def delete(ipp):
    sleep(5)
    del recebidos[ipp]


api.add_resource(Getcripto, "/client")
api.add_resource(GetIP, "/server/<ip>/<code>")

if __name__ == "__main__":
    web.run(port=8080, host="192.168.15.71", debug=True)

